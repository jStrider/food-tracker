#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo "üöÄ Running pre-commit checks..."

# Run lint-staged
npx lint-staged

if [ $? -ne 0 ]; then
  echo "‚ùå Pre-commit checks failed. Please fix the issues before committing."
  exit 1
fi

# Check if docker is running
if ! docker info > /dev/null 2>&1; then
  echo "‚ö†Ô∏è  Docker is not running. Skipping Docker build check."
else
  # Check if Dockerfile or package files have changed
  DOCKER_FILES_CHANGED=$(git diff --cached --name-only | grep -E "(Dockerfile|package\.json|package-lock\.json|\.dockerignore)" | wc -l)
  
  if [ $DOCKER_FILES_CHANGED -gt 0 ]; then
    echo "üê≥ Docker-related files changed. Running Docker Compose build..."
    docker compose build
    
    if [ $? -ne 0 ]; then
      echo "‚ùå Docker Compose build failed. Please fix the build errors before committing."
      exit 1
    fi
  else
    echo "‚ÑπÔ∏è  No Docker-related files changed. Skipping Docker build."
  fi
fi

echo "‚úÖ All checks passed!"